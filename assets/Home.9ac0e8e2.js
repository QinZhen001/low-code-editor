import{s as m,e as h,g as _,c as p,n as v,m as at,a as k,b as f,d as U,f as it,h as w,i as J,j as C,k as S,$ as st,l as rt,o as ct,p as lt,q as ut,r as Q}from"./index.cddf4575.js";function L(t){return t?"infinite":"no-infinite"}const M=async(t,n=[])=>{const e=c=>new Promise(a=>{const{animationTime:i,value:s="",isLoop:r}=c;t.style.setProperty("--time",i+"s"),t.classList.add(s,"animated",L(r));const l=()=>{t.removeEventListener("animationend",l),t.removeEventListener("animationcancel",l),t.classList.remove(s,"animated",L(r)),t.style.removeProperty("--time"),a()};t.addEventListener("animationend",l),t.addEventListener("animationcancel",l)}),o=n.length;for(let c=0;c<o;c++)await e(n[c])},A=17,D=91,dt=86,pt=67,mt=88,ht=89,vt=90,ft=71,_t=66,gt=76,xt=85,yt=83,bt=80,wt=68,Z=46,Ct=69;let $=!1;const $t=()=>{m.commit("paste"),m.commit("recordSnapshot")},St=()=>{m.commit("redo")},kt=()=>{m.commit("undo")},Mt=()=>{h.$emit("save")},Lt=()=>{h.$emit("preview")},At=()=>{h.$emit("clearCanvas")},Dt=()=>{m.commit("unlock")},Pt=()=>{m.commit("lock")},P=()=>{m.state.curComponent&&(m.commit("deleteComponent"),m.commit("recordSnapshot"))},Et=()=>{m.commit("copy")},Rt=()=>{m.commit("cut")},Tt=()=>{m.state.areaData.components.length&&(m.commit("compose"),m.commit("recordSnapshot"))},It=()=>{const t=m.state.curComponent;t&&!t.isLock&&t.component=="Group"&&(m.commit("decompose"),m.commit("recordSnapshot"))},tt={[dt]:$t,[ht]:St,[vt]:kt,[yt]:Mt,[bt]:Lt,[Ct]:At},E={...tt,[xt]:Dt},R={...tt,[pt]:Et,[mt]:Rt,[ft]:Tt,[_t]:It,[wt]:P,[Z]:P,[gt]:Pt},Nt=()=>{window.onkeydown=t=>{if(!m.state.isInEdiotr)return;const{curComponent:n}=m.state,{keyCode:e}=t;e===A||e===D?$=!0:e==Z&&n?(m.commit("deleteComponent"),m.commit("recordSnapshot")):$&&((!n||!n.isLock)&&R[e]?(t.preventDefault(),R[e]()):n&&n.isLock&&E[e]&&(t.preventDefault(),E[e]()))},window.onkeyup=t=>{(t.keyCode===A||t.keyCode===D)&&($=!1)},window.onmousedown=()=>{console.log("onmousedown"),m.commit("setInEditorStatus",!1)}};function jt(t,n,e,o,c){const{symmetricPoint:a}=c;let i=_(n,a),s=p(n,i,-t.rotate),r=p(a,i,-t.rotate),l=r.x-s.x,u=r.y-s.y;if(o){l/u>e?(s.x+=Math.abs(l-u*e),l=u*e):(s.y+=Math.abs(u-l/e),u=l/e);const d=p(s,i,t.rotate);i=_(d,a),s=p(d,i,-t.rotate),r=p(a,i,-t.rotate),l=r.x-s.x,u=r.y-s.y}l>0&&u>0&&(t.width=Math.round(l),t.height=Math.round(u),t.left=Math.round(s.x),t.top=Math.round(s.y))}function zt(t,n,e,o,c){const{symmetricPoint:a}=c;let i=_(n,a),s=p(n,i,-t.rotate),r=p(a,i,-t.rotate),l=s.x-r.x,u=r.y-s.y;if(o){l/u>e?(s.x-=Math.abs(l-u*e),l=u*e):(s.y+=Math.abs(u-l/e),u=l/e);const d=p(s,i,t.rotate);i=_(d,a),s=p(d,i,-t.rotate),r=p(a,i,-t.rotate),l=s.x-r.x,u=r.y-s.y}l>0&&u>0&&(t.width=Math.round(l),t.height=Math.round(u),t.left=Math.round(r.x),t.top=Math.round(s.y))}function Ot(t,n,e,o,c){const{symmetricPoint:a}=c;let i=_(n,a),s=p(a,i,-t.rotate),r=p(n,i,-t.rotate),l=r.x-s.x,u=r.y-s.y;if(o){l/u>e?(r.x-=Math.abs(l-u*e),l=u*e):(r.y-=Math.abs(u-l/e),u=l/e);const d=p(r,i,t.rotate);i=_(d,a),s=p(a,i,-t.rotate),r=p(d,i,-t.rotate),l=r.x-s.x,u=r.y-s.y}l>0&&u>0&&(t.width=Math.round(l),t.height=Math.round(u),t.left=Math.round(s.x),t.top=Math.round(s.y))}function Xt(t,n,e,o,c){const{symmetricPoint:a}=c;let i=_(n,a),s=p(a,i,-t.rotate),r=p(n,i,-t.rotate),l=s.x-r.x,u=r.y-s.y;if(o){l/u>e?(r.x+=Math.abs(l-u*e),l=u*e):(r.y-=Math.abs(u-l/e),u=l/e);const d=p(r,i,t.rotate);i=_(d,a),s=p(a,i,-t.rotate),r=p(d,i,-t.rotate),l=s.x-r.x,u=r.y-s.y}l>0&&u>0&&(t.width=Math.round(l),t.height=Math.round(u),t.left=Math.round(r.x),t.top=Math.round(s.y))}function Yt(t,n,e,o,c){const{symmetricPoint:a,curPoint:i}=c,s=p(n,i,-t.rotate),r=p({x:i.x,y:s.y},i,t.rotate),l=Math.sqrt((r.x-a.x)**2+(r.y-a.y)**2),u={x:r.x-(r.x-a.x)/2,y:r.y+(a.y-r.y)/2};let d=t.width;o&&(d=l*e),t.width=d,t.height=Math.round(l),t.top=Math.round(u.y-l/2),t.left=Math.round(u.x-t.width/2)}function Bt(t,n,e,o,c){const{symmetricPoint:a,curPoint:i}=c,s=p(n,i,-t.rotate),r=p({x:s.x,y:i.y},i,t.rotate),l=Math.sqrt((r.x-a.x)**2+(r.y-a.y)**2),u={x:r.x-(r.x-a.x)/2,y:r.y+(a.y-r.y)/2};let d=t.height;o&&(d=l/e),t.height=d,t.width=Math.round(l),t.top=Math.round(u.y-t.height/2),t.left=Math.round(u.x-l/2)}function Ft(t,n,e,o,c){const{symmetricPoint:a,curPoint:i}=c,s=p(n,i,-t.rotate),r=p({x:i.x,y:s.y},i,t.rotate),l=Math.sqrt((r.x-a.x)**2+(r.y-a.y)**2),u={x:r.x-(r.x-a.x)/2,y:r.y+(a.y-r.y)/2};let d=t.width;o&&(d=l*e),t.width=d,t.height=Math.round(l),t.top=Math.round(u.y-l/2),t.left=Math.round(u.x-t.width/2)}function Kt(t,n,e,o,c){const{symmetricPoint:a,curPoint:i}=c,s=p(n,i,-t.rotate),r=p({x:s.x,y:i.y},i,t.rotate),l=Math.sqrt((r.x-a.x)**2+(r.y-a.y)**2),u={x:r.x-(r.x-a.x)/2,y:r.y+(a.y-r.y)/2};let d=t.height;o&&(d=l/e),t.height=d,t.width=Math.round(l),t.top=Math.round(u.y-t.height/2),t.left=Math.round(u.x-l/2)}const Vt={lt:jt,t:Yt,rt:zt,r:Bt,rb:Ot,b:Ft,lb:Xt,l:Kt},Gt=(t,n,e,o,c,a)=>{Vt[t](n,e,o,c,a)};var Wt=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{on:{click:t.handleClick}},[e(t.config.component,{ref:"component",tag:"component",staticClass:"component",style:t.getStyle(t.config.style),attrs:{"prop-value":t.config.propValue,element:t.config}})],1)},Ht=[];const qt={mixins:[at],props:{config:{type:Object,require:!0,default:()=>{}}},components:{},data(){return{}},created(){},mounted(){M(this.$refs.component.$el,this.config.animations)},methods:{getStyle:k,handleClick(){const t=this.config.events;Object.keys(t).forEach(n=>{this[n](t[n])})}}},T={};var Ut=v(qt,Wt,Ht,!1,Jt,"4135f03a",null,null);function Jt(t){for(let n in T)this[n]=T[n]}var Qt=function(){return Ut.exports}(),Zt=function(){var t=this,n=t.$createElement,e=t._self._c||n;return t.show?e("div",{staticClass:"bg"},[e("el-button",{staticClass:"close",on:{click:t.close}},[t._v("\u5173\u95ED")]),e("div",{staticClass:"canvas-container"},[e("div",{staticClass:"canvas",style:{width:t.changeStyleWithScale(t.canvasStyleData.width)+"px",height:t.changeStyleWithScale(t.canvasStyleData.height)+"px"}},t._l(t.componentData,function(o,c){return e("ComponentWrapper",{key:c,attrs:{config:o}})}),1)])],1):t._e()},te=[];const ee={components:{ComponentWrapper:Qt},props:{show:{type:Boolean,default:!1}},data(){return{}},created(){},mounted(){},computed:f(["componentData","canvasStyleData"]),methods:{changeStyleWithScale:U,getStyle:k,close(){this.$emit("change",!1)}}},I={};var ne=v(ee,Zt,te,!1,oe,"475f4d98",null,null);function oe(t){for(let n in I)this[n]=I[n]}var ae=function(){return ne.exports}(),ie=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("div",{staticClass:"toolbar"},[e("el-button",{on:{click:t.undo}},[t._v("\u64A4\u6D88 undo")]),e("el-button",{on:{click:t.redo}},[t._v("\u91CD\u505A redo")]),e("label",{staticClass:"insert",attrs:{for:"input"}},[t._v("\u63D2\u5165\u56FE\u7247")]),e("input",{attrs:{id:"input",type:"file",hidden:""},on:{change:t.handleFileChange}}),e("el-button",{staticStyle:{"margin-left":"10px"},on:{click:t.preview}},[t._v("\u9884\u89C8")]),e("el-button",{on:{click:t.save}},[t._v("\u4FDD\u5B58")]),e("el-button",{on:{click:t.clearCanvas}},[t._v("\u6E05\u7A7A\u753B\u5E03")]),e("el-button",{attrs:{disabled:!t.areaData.components.length},on:{click:t.compose}},[t._v("\u7EC4\u5408")]),e("el-button",{attrs:{disabled:!t.curComponent||t.curComponent.isLock||t.curComponent.component!="Group"},on:{click:t.decompose}},[t._v(" \u62C6\u5206 ")]),e("el-button",{attrs:{disabled:!t.curComponent||t.curComponent.isLock},on:{click:t.lock}},[t._v("\u9501\u5B9A")]),e("el-button",{attrs:{disabled:!t.curComponent||!t.curComponent.isLock},on:{click:t.unlock}},[t._v("\u89E3\u9501")]),e("div",{staticClass:"canvas-config"},[e("span",[t._v("\u753B\u5E03\u5927\u5C0F")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.canvasStyleData.width,expression:"canvasStyleData.width"}],domProps:{value:t.canvasStyleData.width},on:{input:function(o){o.target.composing||t.$set(t.canvasStyleData,"width",o.target.value)}}}),e("span",[t._v("*")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.canvasStyleData.height,expression:"canvasStyleData.height"}],domProps:{value:t.canvasStyleData.height},on:{input:function(o){o.target.composing||t.$set(t.canvasStyleData,"height",o.target.value)}}})]),e("div",{staticClass:"canvas-config"},[e("span",[t._v("\u753B\u5E03\u6BD4\u4F8B")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.scale,expression:"scale"}],domProps:{value:t.scale},on:{input:[function(o){o.target.composing||(t.scale=o.target.value)},t.handleScaleChange]}}),t._v(" % ")])],1),e("Preview",{on:{change:t.handlePreviewChange},model:{value:t.isShowPreview,callback:function(o){t.isShowPreview=o},expression:"isShowPreview"}})],1)},se=[];const re={components:{Preview:ae},data(){return{isShowPreview:!1,needToChange:["top","left","width","height","fontSize"],scale:"100%",timer:null}},computed:f(["componentData","canvasStyleData","areaData","curComponent","curComponentIndex"]),created(){h.$on("preview",this.preview),h.$on("save",this.save),h.$on("clearCanvas",this.clearCanvas),this.scale=this.canvasStyleData.scale},methods:{format(t){return it(t,w(parseFloat(this.scale),100))},getOriginStyle(t){return w(t,w(parseFloat(this.canvasStyleData.scale),100))},handleScaleChange(){clearTimeout(this.timer),this.timer=setTimeout(()=>{})},lock(){},unlock(){},compose(){},decompose(){},undo(){},redo(){},handleFileChange(){},preview(){},save(){},clearCanvas(){},handlePreviewChange(){}}},N={};var ce=v(re,ie,se,!1,le,"59d94bd7",null,null);function le(t){for(let n in N)this[n]=N[n]}var ue=function(){return ce.exports}(),de=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"component-list",on:{dragstart:t.handleDragStart}},t._l(t.componentList,function(o,c){return e("div",{key:c,staticClass:"list",attrs:{draggable:"","data-index":c}},[e("span",{staticClass:"iconfont",class:"icon-"+o.icon}),e("span",[t._v(t._s(o.label))])])}),0)},pe=[];const me={data(){return{componentList:J}},methods:{handleDragStart(t){t.dataTransfer.setData("index",t.target.dataset.index)}}},j={};var he=v(me,de,pe,!1,ve,"4757d6e4",null,null);function ve(t){for(let n in j)this[n]=j[n]}var et=function(){return he.exports}(),fe=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("svg",{staticClass:"grid",attrs:{width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg"}},[e("defs",[e("pattern",{attrs:{id:"smallGrid",width:"7.236328125",height:"7.236328125",patternUnits:"userSpaceOnUse"}},[e("path",{attrs:{d:"M 7.236328125 0 L 0 0 0 7.236328125",fill:"none",stroke:"rgba(207, 207, 207, 0.3)","stroke-width":"1"}})]),e("pattern",{attrs:{id:"grid",width:"36.181640625",height:"36.181640625",patternUnits:"userSpaceOnUse"}},[e("rect",{attrs:{width:"36.181640625",height:"36.181640625",fill:"url(#smallGrid)"}}),e("path",{attrs:{d:"M 36.181640625 0 L 0 0 0 36.181640625",fill:"none",stroke:"rgba(186, 186, 186, 0.5)","stroke-width":"1"}})])]),e("rect",{attrs:{width:"100%",height:"100%",fill:"url(#grid)"}})])},_e=[];const ge={},z={};var xe=v(ge,fe,_e,!1,ye,"5a5f3a06",null,null);function ye(t){for(let n in z)this[n]=z[n]}var be=function(){return xe.exports}(),we=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.menuShow,expression:"menuShow"}],staticClass:"contextmenu",style:{top:t.menuTop+"px",left:t.menuLeft+"px"}},[e("ul",{on:{mouseup:t.handleMouseUp}},[t.curComponent?[t.curComponent.isLock?e("li",{on:{click:t.unlock}},[t._v("\u89E3\u9501")]):[e("li",{on:{click:t.copy}},[t._v("\u590D\u5236")]),e("li",{on:{click:t.paste}},[t._v("\u7C98\u8D34")]),e("li",{on:{click:t.cut}},[t._v("\u526A\u5207")]),e("li",{on:{click:t.deleteComponent}},[t._v("\u5220\u9664")]),e("li",{on:{click:t.lock}},[t._v("\u9501\u5B9A")]),e("li",{on:{click:t.topComponent}},[t._v("\u7F6E\u9876")]),e("li",{on:{click:t.bottomComponent}},[t._v("\u7F6E\u5E95")]),e("li",{on:{click:t.upComponent}},[t._v("\u4E0A\u79FB")]),e("li",{on:{click:t.downComponent}},[t._v("\u4E0B\u79FB")])]]:e("li",{on:{click:t.paste}},[t._v("\u7C98\u8D34")])],2)])},Ce=[];const $e={data(){return{copyData:null}},computed:f(["menuTop","menuLeft","menuShow","curComponent"]),methods:{lock(){this.$store.commit("lock")},unlock(){this.$store.commit("unlock")},handleMouseUp(){this.$store.commit("setClickComponentStatus",!0)},cut(){this.$store.commit("cut")},copy(){this.$store.commit("copy")},paste(){this.$store.commit("paste",!0),this.$store.commit("recordSnapshot")},deleteComponent(){this.$store.commit("deleteComponent"),this.$store.commit("recordSnapshot")},upComponent(){this.$store.commit("upComponent"),this.$store.commit("recordSnapshot")},downComponent(){this.$store.commit("downComponent"),this.$store.commit("recordSnapshot")},topComponent(){this.$store.commit("topComponent"),this.$store.commit("recordSnapshot")},bottomComponent(){this.$store.commit("bottomComponent"),this.$store.commit("recordSnapshot")}}},O={};var Se=v($e,we,Ce,!1,ke,"6a2116bc",null,null);function ke(t){for(let n in O)this[n]=O[n]}var Me=function(){return Se.exports}(),Le=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"shape",class:{active:t.active},on:{click:t.selectCurComponent,mousedown:t.handleMouseDownOnShape}},[e("span",{directives:[{name:"show",rawName:"v-show",value:t.isActive(),expression:"isActive()"}],staticClass:"iconfont icon-xiangyouxuanzhuan",on:{mousedown:t.handleRotate}}),e("span",{directives:[{name:"show",rawName:"v-show",value:t.element.isLock,expression:"element.isLock"}],staticClass:"iconfont icon-suo"}),t._l(t.isActive()?t.pointList:[],function(o){return e("div",{key:o,staticClass:"shape-point",style:t.getPointStyle(o),on:{mousedown:function(c){return t.handleMouseDownOnPoint(o,c)}}})}),t._t("default")],2)},Ae=[];const De={props:{active:{type:Boolean,default:!1},element:{require:!0,type:Object,default:()=>{}},defaultStyle:{require:!0,type:Object,default:()=>{}},index:{require:!0,type:[Number,String],default:0}},data(){return{pointList:["lt","t","rt","r","rb","b","lb","l"],initialAngle:{lt:0,t:45,rt:90,r:135,rb:180,b:225,lb:270,l:315},angleToCursor:[{start:338,end:23,cursor:"nw"},{start:23,end:68,cursor:"n"},{start:68,end:113,cursor:"ne"},{start:113,end:158,cursor:"e"},{start:158,end:203,cursor:"se"},{start:203,end:248,cursor:"s"},{start:248,end:293,cursor:"sw"},{start:293,end:338,cursor:"w"}],cursors:{}}},computed:f(["curComponent","editor"]),mounted(){this.curComponent&&(this.cursors=this.getCursor()),h.$on("runAnimation",()=>{this.element==this.curComponent&&(console.log("this.$el",this.$el),M(this.$el,this.curComponent.animations))}),h.$on("stopAnimation",()=>{this.$el.classList.remove("animated","infinite")})},methods:{isActive(){return this.active&&!this.element.isLock},getPointStyle(t){const{width:n,height:e}=this.defaultStyle,o=/t/.test(t),c=/b/.test(t),a=/l/.test(t),i=/r/.test(t);let s=0,r=0;return t.length===2?(s=a?0:n,r=o?0:e):((o||c)&&(s=n/2,r=o?0:e),(a||i)&&(s=a?0:n,r=Math.floor(e/2))),{marginLeft:"-4px",marginTop:"-4px",left:`${s}px`,top:`${r}px`,cursor:this.cursors[t]}},getCursor(){const{angleToCursor:t,initialAngle:n,pointList:e,curComponent:o}=this,c=C(o.style.rotate),a={};let i=-1;return e.forEach(s=>{const r=C(n[s]+c),l=t.length;for(;;){i=(i+1)%l;const u=t[i];if(r<23||r>=338){a[s]="nw-resize";return}if(u.start<=r&&r<u.end){a[s]=u.cursor+"-resize";return}}}),a},handleRotate(t){this.$store.commit("setClickComponentStatus",!0),t.preventDefault(),t.stopPropagation();const n={...this.defaultStyle},e=t.clientY,o=t.clientX,c=n.rotate,a=this.$el.getBoundingClientRect(),i=a.left+a.width/2,s=a.top+a.height/2,r=Math.atan2(e-s,o-i)/(Math.PI/180);let l=!1;const u=g=>{l=!0;const x=g.clientX,y=g.clientY,b=Math.atan2(y-s,x-i)/(Math.PI/180);n.rotate=c+b-r,this.$store.commit("setShapeStyle",n)},d=()=>{l&&this.$store.commit("recordSnapshot"),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",d),this.cursors=this.getCursor()};document.addEventListener("mousemove",u),document.addEventListener("mouseup",d)},handleMouseDownOnShape(t){if(this.$store.commit("setInEditorStatus",!0),this.$store.commit("setClickComponentStatus",!0),this.element.component!="v-text"&&this.element.component!="rect-shape"&&t.preventDefault(),t.stopPropagation(),this.$store.commit("setCurComponent",{component:this.element,index:this.index}),this.element.isLock)return;this.cursors=this.getCursor();const n={...this.defaultStyle},e=t.clientY,o=t.clientX,c=Number(n.top),a=Number(n.left);let i=!1;const s=l=>{i=!0;const u=l.clientX,d=l.clientY;n.top=d-e+c,n.left=u-o+a,this.$store.commit("setShapeStyle",n),this.$nextTick(()=>{h.$emit("move",d-e>0,u-o>0)})},r=()=>{i&&this.$store.commit("recordSnapshot"),h.$emit("unmove"),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",r)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",r)},handleMouseDownOnPoint(t,n){n.stopPropagation(),n.preventDefault(),this.$store.commit("setInEditorStatus",!0),this.$store.commit("setClickComponentStatus",!0);const e={...this.defaultStyle},o=e.width/e.height,c={x:e.left+e.width/2,y:e.top+e.height/2},a=this.editor.getBoundingClientRect(),i=n.target.getBoundingClientRect(),s={x:Math.round(i.left-a.left+n.target.offsetWidth/2),y:Math.round(i.top-a.top+n.target.offsetHeight/2)},r={x:c.x-(s.x-c.x),y:c.y-(s.y-c.y)};let l=!1,u=!0;const d=this.isNeedLockProportion(),g=y=>{if(u){u=!1;return}l=!0;const b={x:y.clientX-a.left,y:y.clientY-a.top};Gt(t,e,b,o,d,{center:c,curPoint:s,symmetricPoint:r}),this.$store.commit("setShapeStyle",e)},x=()=>{document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",x),l&&this.$store.commit("recordSnapshot")};document.addEventListener("mousemove",g),document.addEventListener("mouseup",x)},selectCurComponent(t){t.stopPropagation(),t.preventDefault(),this.$store.commit("hideContextMenu")},isNeedLockProportion(){if(this.element.componnet!="Group")return!1;const t=[0,90,180,360];for(const n of this.element.propValue)if(!t.includes(C(parseInt(n.style.rotate))))return!0;return!1}}},X={};var Pe=v(De,Le,Ae,!1,Ee,"47a44cea",null,null);function Ee(t){for(let n in X)this[n]=X[n]}var Re=function(){return Pe.exports}(),Te=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"mark-line"},t._l(t.lines,function(o){return e("div",{directives:[{name:"show",rawName:"v-show",value:t.lineStatus[o]||!1,expression:"lineStatus[line] || false"}],key:o,ref:o,refInFor:!0,staticClass:"line",class:o.includes("x")?"xline":"yline"})}),0)},Ie=[];const Ne={data(){return{lines:["xt","xc","xb","yl","yc","yr"],diff:3,lineStatus:{xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}}},computed:f(["componentData","curComponent"]),mounted(){h.$on("move",(t,n)=>{this.showLine(t,n)}),h.$on("unmove",()=>{this.hideLine()})},methods:{hideLine(){Object.keys(this.lineStatus).forEach(t=>{this.lineStatus[t]=!1})},showLine(t,n){this.$refs,this.componentData,S(this.curComponent.style)}}},Y={};var je=v(Ne,Te,Ie,!1,ze,null,null,null);function ze(t){for(let n in Y)this[n]=Y[n]}var Oe=function(){return je.exports}(),Xe=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"area",style:{left:t.start.x+"px",top:t.start.y+"px",width:t.width+"px",height:t.height+"px"}})},Ye=[];const Be={props:{start:{type:Object,default:()=>{}},width:{type:Number,default:0},height:{type:Number,default:0}}},B={};var Fe=v(Be,Xe,Ye,!1,Ke,"38da664e",null,null);function Ke(t){for(let n in B)this[n]=B[n]}var Ve=function(){return Fe.exports}(),Ge=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"editor",class:{edit:t.isEdit},style:{width:t.changeStyleWithScale(t.canvasStyleData.width)+"px",height:t.changeStyleWithScale(t.canvasStyleData.height)+"px"},attrs:{id:"editor"},on:{contextmenu:t.handleContextMenu,mousedown:t.handleMouseDown}},[e("Grid"),t._l(t.componentData,function(o,c){return e("Shape",{key:o.id,class:{lock:o.isLock},style:t.getShapeStyle(o.style),attrs:{"default-style":o.style,active:o.id==(t.curComponent||{}).id,element:o,index:c}},[o.component!="v-text"?e(o.component,{tag:"component",staticClass:"component",style:t.getComponentStyle(o.style),attrs:{id:"component"+o.id,"prop-value":o.propValue,element:o}}):e(o.component,{tag:"component",staticClass:"component",style:t.getComponentStyle(o.style),attrs:{id:"component"+o.id,"prop-value":o.propValue,element:o},on:{input:t.handleInput}})],1)}),e("ContextMenu"),e("MarkLine"),e("Area",{directives:[{name:"show",rawName:"v-show",value:t.isShowArea,expression:"isShowArea"}],attrs:{start:t.start,width:t.width,height:t.height}})],2)},We=[];const He=(t,n)=>{console.log("element, text",t,n);let{lineHeight:e,fontSize:o,height:c}=t.style;e===""&&(e=1.5);const a=(n.split("<br>").length-1)*e*o;return c>a?c:a},qe={components:{Grid:be,ContextMenu:Me,MarkLine:Oe,Shape:Re,ComponentList:et,Area:Ve},props:{isEdit:{type:Boolean,default:!0}},data(){return{editorX:0,editorY:0,start:{x:0,y:0},width:0,height:0,isShowArea:!1}},computed:f(["componentData","curComponent","canvasStyleData","editor"]),mounted(){this.$store.commit("getEditor"),h.$on("hideArea",()=>{this.hideArea()})},methods:{changeStyleWithScale:U,handleInput(t,n){this.$store.commit("setShapeStyle",{height:He(t,n)})},handleContextMenu(t){t.stopPropagation(),t.preventDefault();let n=t.target,e=t.offsetY,o=t.offsetX;for(;n instanceof SVGElement;)n=n.parentNode;for(;!n.className.includes("editor");)o+=n.offsetLeft,e+=n.offsetTop,n=n.parentNode;this.$store.commit("showContextMenu",{top:e,left:o})},handleMouseDown(t){(!this.curComponent||this.curComponent.component!="v-text"&&this.curComponent.component!="rect-shape")&&t.preventDefault(),this.hideArea();const n=this.editor.getBoundingClientRect();this.editorX=n.x,this.editorY=n.y;const e=t.clientX,o=t.clientY;this.start.x=e-this.editorX,this.start.y=o-this.editorY,this.isShowArea=!0;const c=i=>{this.width=Math.abs(i.clientX-e),this.height=Math.abs(i.clientY-o),i.clientX<e&&(this.start.x=i.clientX-this.editorX),i.clientY<o&&(this.start.y=i.clientY-this.editorY),console.log("move",this.start,this.width,this.height)},a=i=>{if(document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",a),i.clientX==e&&i.clientY==o){this.hideArea();return}this.createGroup()};document.addEventListener("mousemove",c),document.addEventListener("mouseup",a)},createGroup(){const t=this.getSelectArea();if(t.length<=1){this.hideArea();return}let n=1/0,e=1/0,o=-1/0,c=-1/0;t.forEach(a=>{let i={};a.component==="Group"?a.propValue.forEach(s=>{const r=st(`#component${s.id}`).getBoundingClientRect();i.left=r.left-this.editorX,i.top=r.top-this.editorY,i.right=r.right-this.editorX,i.bottom=r.bottom-this.editorY,i.left<e&&(e=i.left),i.top<n&&(n=i.top),i.right>o&&(o=i.right),i.bottom>c&&(c=i.bottom)}):i=S(a.style),i.left<e&&(e=i.left),i.top<n&&(n=i.top),i.right>o&&(o=i.right),i.bottom>c&&(c=i.bottom)}),this.start.x=e,this.start.y=n,this.width=o-e,this.height=c-n,this.$store.commit("setAreaData",{style:{left:e,top:n,width:this.width,height:this.height},components:t})},getSelectArea(){const t=[],{x:n,y:e}=this.start;return this.componentData.forEach(o=>{if(o.isLock)return;const{left:c,top:a,width:i,height:s}=S(o.style);n<=c&&e<=a&&c+i<=n+this.width&&a+s<=e+this.height&&t.push(o)}),t},hideArea(){this.isShowArea=!1,this.width=0,this.height=0,this.$store.commit("setAreaData",{style:{left:0,top:0,width:0,height:0},components:[]})},getShapeStyle(t){const n={};return["width","height","top","left","rotate"].forEach(e=>{e!="rotate"?n[e]=t[e]+"px":n.transform="rotate("+t[e]+"deg)"}),n},getComponentStyle(t){return k(t,["top","left","width","height","rotate"])}}},F={};var Ue=v(qe,Ge,We,!1,Je,"49cac0d5",null,null);function Je(t){for(let n in F)this[n]=F[n]}var Qe=function(){return Ue.exports}(),Ze=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"attr-list"},[e("el-form",[t._l(t.styleKeys,function(o,c){var a=o.key,i=o.label;return e("el-form-item",{key:c,attrs:{label:i}},[a=="borderColor"?e("el-color-picker",{model:{value:t.curComponent.style[a],callback:function(s){t.$set(t.curComponent.style,a,s)},expression:"curComponent.style[key]"}}):a=="color"?e("el-color-picker",{model:{value:t.curComponent.style[a],callback:function(s){t.$set(t.curComponent.style,a,s)},expression:"curComponent.style[key]"}}):a=="backgroundColor"?e("el-color-picker",{model:{value:t.curComponent.style[a],callback:function(s){t.$set(t.curComponent.style,a,s)},expression:"curComponent.style[key]"}}):t.selectKey.includes(a)?e("el-select",{model:{value:t.curComponent.style[a],callback:function(s){t.$set(t.curComponent.style,a,s)},expression:"curComponent.style[key]"}},[a=="textAlign"?t._l(t.textAlignOptions,function(s){return e("el-option",{key:s.value,attrs:{label:s.label,value:s.value}})}):a=="borderStyle"?t._l(t.borderStyleOptions,function(s){return e("el-option",{key:s.value,attrs:{label:s.label,value:s.value}})}):t._l(t.verticalAlignOptions,function(s){return e("el-option",{key:s.value,attrs:{label:s.label,value:s.value}})})],2):e("el-input",{attrs:{type:"number"},model:{value:t.curComponent.style[a],callback:function(s){t.$set(t.curComponent.style,a,t._n(s))},expression:"curComponent.style[key]"}})],1)}),t.curComponent&&!t.excludes.includes(t.curComponent.component)?e("el-form-item",{attrs:{label:"\u5185\u5BB9"}},[e("el-input",{attrs:{type:"textarea"},model:{value:t.curComponent.propValue,callback:function(o){t.$set(t.curComponent,"propValue",o)},expression:"curComponent.propValue"}})],1):t._e(),t.curComponent&&t.curComponent.component==="Picture"?e("el-form-item",{attrs:{label:"\u955C\u50CF\u7FFB\u8F6C"}},[e("div",{staticStyle:{clear:"both"}},[e("el-checkbox",{attrs:{label:"horizontal"},model:{value:t.curComponent.propValue.flip.horizontal,callback:function(o){t.$set(t.curComponent.propValue.flip,"horizontal",o)},expression:"curComponent.propValue.flip.horizontal"}},[t._v("\u6C34\u5E73\u7FFB\u8F6C")]),e("el-checkbox",{attrs:{label:"vertical"},model:{value:t.curComponent.propValue.flip.vertical,callback:function(o){t.$set(t.curComponent.propValue.flip,"vertical",o)},expression:"curComponent.propValue.flip.vertical"}},[t._v("\u5782\u76F4\u7FFB\u8F6C")])],1)]):t._e()],2)],1)},tn=[];const en={components:{},data(){return{excludes:["Picture","Group"],textAlignOptions:[{label:"\u5DE6\u5BF9\u9F50",value:"left"},{label:"\u5C45\u4E2D",value:"center"},{label:"\u53F3\u5BF9\u9F50",value:"right"}],borderStyleOptions:[{label:"\u5B9E\u7EBF",value:"solid"},{label:"\u865A\u7EBF",value:"dashed"}],verticalAlignOptions:[{label:"\u4E0A\u5BF9\u9F50",value:"top"},{label:"\u5C45\u4E2D\u5BF9\u9F50",value:"middle"},{label:"\u4E0B\u5BF9\u9F50",value:"bottom"}],selectKey:["textAlign","borderStyle","verticalAlign"],styleData:rt}},created(){},mounted(){},methods:{},computed:{styleKeys(){if(this.curComponent){const t=Object.keys(this.curComponent.style);return this.styleData.filter(n=>t.includes(n.key))}return[]},curComponent(){return this.$store.state.curComponent}}},K={};var nn=v(en,Ze,tn,!1,on,"31868d65",null,null);function on(t){for(let n in K)this[n]=K[n]}var an=function(){return nn.exports}(),sn=function(){var t=this,n=t.$createElement,e=t._self._c||n;return t.show?e("div",{staticClass:"modal-bg",on:{click:t.hide}},[e("div",{staticClass:"fadeInLeft animated modal",on:{click:t.stopPropagation}},[t._t("default")],2)]):t._e()},rn=[];const cn={model:{prop:"show",event:"change"},props:{show:{type:Boolean,default:!1}},components:{},data(){return{}},created(){},mounted(){},methods:{hide(){this.$emit("change")},stopPropagation(t){t.stopPropagation()}}},V={};var ln=v(cn,sn,rn,!1,un,"e1764b10",null,null);function un(t){for(let n in V)this[n]=V[n]}var nt=function(){return ln.exports}(),dn=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("el-dialog",{attrs:{title:`${t.config.label} \u52A8\u753B\u914D\u7F6E`,visible:t.centerDialogVisible,width:"30%",center:""},on:{close:t.handleCloseModal}},[e("div",{staticClass:"time"},[t._v(" \u52A8\u753B\u65F6\u957F\uFF1A"),e("el-input-number",{attrs:{"controls-position":"right",min:.1,precision:2,step:.01},model:{value:t.config.animationTime,callback:function(o){t.$set(t.config,"animationTime",o)},expression:"config.animationTime"}})],1),e("div",{staticClass:"loop"},[t._v(" \u662F\u5426\u5FAA\u73AF\uFF1A"),e("el-switch",{attrs:{"active-text":"\u662F","inactive-text":"\u5426",disabled:t.isDisabled},model:{value:t.config.isLoop,callback:function(o){t.$set(t.config,"isLoop",o)},expression:"config.isLoop"}})],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.handleCloseModal}},[t._v("\u53D6 \u6D88")]),e("el-button",{attrs:{type:"primary"},on:{click:t.handleSaveSetting}},[t._v("\u786E \u5B9A")])],1)])},pn=[];const mn={name:"AnimationSettingModal",props:{curIndex:{type:Number,default:0}},components:{},data(){return{centerDialogVisible:!0,config:{}}},computed:{...f(["curComponent"]),isDisabled(){return this.curComponent.animations.length>1}},created(){const{label:t,animationTime:n,isLoop:e=!1,value:o}=this.curComponent.animations[this.curIndex]||{};this.config={animationTime:n,label:t,isLoop:e,value:o}},mounted(){},methods:{handleCloseModal(){this.$emit("close")},handleSaveSetting(){const{isLoop:t}=this.config;this.$store.commit("alterAnimation",{index:this.curIndex,data:{animationTime:this.config.animationTime,isLoop:t}}),h.$emit("stopAnimation"),this.handleCloseModal()}}},G={};var hn=v(mn,dn,pn,!1,vn,"78a8f4e4",null,null);function vn(t){for(let n in G)this[n]=G[n]}var fn=function(){return hn.exports}(),_n=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"animation-list"},[e("div",{staticClass:"div-animation"},[e("el-button",{on:{click:function(o){t.isShowAnimation=!0}}},[t._v("\u6DFB\u52A0\u52A8\u753B")]),e("el-button",{on:{click:t.previewAnimate}},[t._v("\u9884\u89C8\u52A8\u753B")]),e("div",t._l(t.curComponent.animations,function(o,c){return e("el-tag",{key:c,attrs:{closable:""},on:{close:function(a){return t.removeAnimation(c)}}},[t._v(" "+t._s(o.label)+" "),e("i",{staticClass:"cursor el-icon-setting",on:{click:function(a){return t.handleAnimationSetting(c)}}})])}),1)],1),e("Modal",{model:{value:t.isShowAnimation,callback:function(o){t.isShowAnimation=o},expression:"isShowAnimation"}},[e("el-tabs",{model:{value:t.animationActiveName,callback:function(o){t.animationActiveName=o},expression:"animationActiveName"}},t._l(t.animationClassData,function(o){return e("el-tab-pane",{key:o.label,attrs:{label:o.label,name:o.label}},[e("el-scrollbar",{staticClass:"animate-container"},t._l(o.children,function(c){return e("div",{key:c.value,ref:c.value,refInFor:!0,staticClass:"animate",on:{mouseenter:function(a){return t.runAnimation(c)},click:function(a){return t.addAnimation(c)}}},[e("div",[t._v(" "+t._s(c.label)+" ")])])}),0)],1)}),1)],1),t.isShowAnimationSetting?e("AnimationSettingModal",{attrs:{"cur-index":t.curIndex},on:{close:function(o){t.isShowAnimationSetting=!1}}}):t._e()],1)},gn=[];const xn={components:{Modal:nt,AnimationSettingModal:fn},data(){return{isShowAnimation:!1,hoverPreviewAnimate:"",animationActiveName:"\u8FDB\u5165",animationClassData:ct,showAnimatePanel:!1,timer:null,isShowAnimationSetting:!1,curIndex:0}},computed:f(["curComponent"]),created(){},mounted(){},methods:{addAnimation(t){this.$store.commit("addAnimation",t),this.isShowAnimation=!1},previewAnimate(){h.$emit("runAnimation")},removeAnimation(t){this.$store.commit("removeAnimation",t),this.curComponent.animations.length||h.$emit("stopAnimation")},handleAnimationSetting(t){this.isShowAnimationSetting=!0,this.curIndex=t},async runAnimation(t){t.pending||(t.pending=!0,await M(this.$refs[t.value][0],[t]),setTimeout(()=>{t.pending=!1},100))}}},W={};var yn=v(xn,_n,gn,!1,bn,null,null,null);function bn(t){for(let n in W)this[n]=W[n]}var wn=function(){return yn.exports}(),Cn=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"event-list"},[e("div",{staticClass:"div-events"},[e("el-button",{on:{click:function(o){t.isShowEvent=!0}}},[t._v("\u6DFB\u52A0\u4E8B\u4EF6")]),e("div",t._l(Object.keys(t.curComponent.events),function(o){return e("el-tag",{key:o,attrs:{closable:""},on:{close:function(c){return t.removeEvent(o)}}},[t._v(" "+t._s(o)+" ")])}),1)],1),e("Modal",{model:{value:t.isShowEvent,callback:function(o){t.isShowEvent=o},expression:"isShowEvent"}},[e("el-tabs",{model:{value:t.eventActiveName,callback:function(o){t.eventActiveName=o},expression:"eventActiveName"}},t._l(t.eventList,function(o){return e("el-tab-pane",{key:o.key,staticStyle:{padding:"0 20px"},attrs:{label:o.label,name:o.key}},[o.key=="redirect"?e("el-input",{attrs:{type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u5B8C\u6574\u7684 URL"},nativeOn:{keydown:function(c){c.stopPropagation()}},model:{value:o.param,callback:function(c){t.$set(o,"param",c)},expression:"item.param"}}):t._e(),o.key=="alert"?e("el-input",{attrs:{type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u8981 alert \u7684\u5185\u5BB9"},nativeOn:{keydown:function(c){c.stopPropagation()}},model:{value:o.param,callback:function(c){t.$set(o,"param",c)},expression:"item.param"}}):t._e(),e("el-button",{staticStyle:{"margin-top":"20px"},on:{click:function(c){return t.addEvent(o.key,o.param)}}},[t._v("\u786E\u5B9A")])],1)}),1)],1)],1)},$n=[];const Sn={components:{Modal:nt},data(){return{isShowEvent:!1,eventURL:"",eventActiveName:"redirect",eventList:lt}},created(){},mounted(){},computed:f(["curComponent"]),methods:{addEvent(t,n){this.isShowEvent=!1,this.$store.commit("addEvent",{event:t,param:n})},removeEvent(t){this.$store.commit("removeEvent",t)}}},H={};var kn=v(Sn,Cn,$n,!1,Mn,"60e8e256",null,null);function Mn(t){for(let n in H)this[n]=H[n]}var Ln=function(){return kn.exports}(),An=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"home"},[e("Toolbar"),e("main",[e("section",{staticClass:"left"},[e("ComponentList")],1),e("section",{staticClass:"center"},[e("div",{staticClass:"content",on:{drop:t.handleDrop,dragover:t.handleDragOver,mousedown:t.handleMouseDown,mouseup:t.deselectCurComponent}},[e("Editor")],1)]),e("section",{staticClass:"right"},[e("el-tabs",{model:{value:t.activeName,callback:function(o){t.activeName=o},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:"\u5C5E\u6027",name:"attr"}},[t.curComponent?e("AttrList"):e("p",{staticClass:"placeholder"},[t._v("\u8BF7\u9009\u62E9\u7EC4\u4EF6")])],1),e("el-tab-pane",{attrs:{label:"\u52A8\u753B",name:"animation"}},[t.curComponent?e("AnimationList"):e("p",{staticClass:"placeholder"},[t._v("\u8BF7\u9009\u62E9\u7EC4\u4EF6")])],1),e("el-tab-pane",{attrs:{label:"\u4E8B\u4EF6",name:"events"}},[t.curComponent?e("EventList"):e("p",{staticClass:"placeholder"},[t._v("\u8BF7\u9009\u62E9\u7EC4\u4EF6")])],1)],1)],1)])],1)},Dn=[];const ot=t=>{t.forEach(n=>{n.id=Q(),n.component==="Group"&&ot(n.propValue)})},Pn={components:{Toolbar:ue,ComponentList:et,Editor:Qe,AttrList:an,AnimationList:wn,EventList:Ln},data(){return{activeName:"attr",reSelectAnimateIndex:void 0}},computed:f(["componentData","curComponent","isClickComponent","canvasStyleData","editor"]),created(){this.restore(),Nt()},methods:{restore(){const t=localStorage.getItem("canvasData"),n=localStorage.getItem("canvasStyle");t&&this.$store.commit("setComponentData",ot(JSON.parse(t))),n&&this.$store.commit("setCanvasStyle",n)},handleDrop(t){console.log("handleDrop",t),t.preventDefault(),t.stopPropagation();const n=t.dataTransfer.getData("index"),e=this.editor.getBoundingClientRect();if(n){const o=ut(J[n]);o.style.top=t.clientY-e.y,o.style.left=t.clientX-e.x,o.id=Q(),this.$store.commit("addComponent",{component:o}),this.$store.commit("recordSnapshot")}},handleDragOver(t){console.log("handleDragOver",t),t.preventDefault(),t.dataTransfer.dropEffect="copy"},handleMouseDown(t){t.stopPropagation(),this.$store.commit("setClickComponentStatus",!1),this.$store.commit("setInEditorStatus",!0)},deselectCurComponent(t){this.isClickComponent||this.$store.commit("setCurComponent",{component:null,index:null}),t.button!=2&&this.$store.commit("hideContextMenu")}}},q={};var En=v(Pn,An,Dn,!1,Rn,null,null,null);function Rn(t){for(let n in q)this[n]=q[n]}var In=function(){return En.exports}();export{In as default};
