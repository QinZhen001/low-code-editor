import{s as m,e as h,g as _,c as p,n as v,m as st,a as M,b as f,d as Q,f as rt,h as C,i as Z,t as ct,j as lt,k as L,l as ut,$ as k,o as tt,p as $,q as b,r as dt,u as pt,v as mt}from"./index.3991e0ea.js";function D(t){return t?"infinite":"no-infinite"}const A=async(t,n=[])=>{const e=r=>new Promise(a=>{const{animationTime:i,value:s="",isLoop:c}=r;t.style.setProperty("--time",i+"s"),t.classList.add(s,"animated",D(c));const l=()=>{t.removeEventListener("animationend",l),t.removeEventListener("animationcancel",l),t.classList.remove(s,"animated",D(c)),t.style.removeProperty("--time"),a()};t.addEventListener("animationend",l),t.addEventListener("animationcancel",l)}),o=n.length;for(let r=0;r<o;r++)await e(n[r])},P=17,E=91,ht=86,vt=67,ft=88,_t=89,gt=90,xt=71,yt=66,bt=76,wt=85,Ct=83,$t=80,St=68,et=46,kt=69;let S=!1;const Mt=()=>{m.commit("paste"),m.commit("recordSnapshot")},Lt=()=>{m.commit("redo")},At=()=>{m.commit("undo")},Dt=()=>{h.$emit("save")},Pt=()=>{h.$emit("preview")},Et=()=>{h.$emit("clearCanvas")},Rt=()=>{m.commit("unlock")},It=()=>{m.commit("lock")},R=()=>{m.state.curComponent&&(m.commit("deleteComponent"),m.commit("recordSnapshot"))},Tt=()=>{m.commit("copy")},Nt=()=>{m.commit("cut")},Ot=()=>{m.state.areaData.components.length&&(m.commit("compose"),m.commit("recordSnapshot"))},jt=()=>{const t=m.state.curComponent;t&&!t.isLock&&t.component=="Group"&&(m.commit("decompose"),m.commit("recordSnapshot"))},nt={[ht]:Mt,[_t]:Lt,[gt]:At,[Ct]:Dt,[$t]:Pt,[kt]:Et},I={...nt,[wt]:Rt},T={...nt,[vt]:Tt,[ft]:Nt,[xt]:Ot,[yt]:jt,[St]:R,[et]:R,[bt]:It},zt=()=>{window.onkeydown=t=>{if(!m.state.isInEdiotr)return;const{curComponent:n}=m.state,{keyCode:e}=t;e===P||e===E?S=!0:e==et&&n?(m.commit("deleteComponent"),m.commit("recordSnapshot")):S&&((!n||!n.isLock)&&T[e]?(t.preventDefault(),T[e]()):n&&n.isLock&&I[e]&&(t.preventDefault(),I[e]()))},window.onkeyup=t=>{(t.keyCode===P||t.keyCode===E)&&(S=!1)},window.onmousedown=()=>{console.log("onmousedown"),m.commit("setInEditorStatus",!1)}};function Ft(t,n,e,o,r){const{symmetricPoint:a}=r;let i=_(n,a),s=p(n,i,-t.rotate),c=p(a,i,-t.rotate),l=c.x-s.x,u=c.y-s.y;if(o){l/u>e?(s.x+=Math.abs(l-u*e),l=u*e):(s.y+=Math.abs(u-l/e),u=l/e);const d=p(s,i,t.rotate);i=_(d,a),s=p(d,i,-t.rotate),c=p(a,i,-t.rotate),l=c.x-s.x,u=c.y-s.y}l>0&&u>0&&(t.width=Math.round(l),t.height=Math.round(u),t.left=Math.round(s.x),t.top=Math.round(s.y))}function Xt(t,n,e,o,r){const{symmetricPoint:a}=r;let i=_(n,a),s=p(n,i,-t.rotate),c=p(a,i,-t.rotate),l=s.x-c.x,u=c.y-s.y;if(o){l/u>e?(s.x-=Math.abs(l-u*e),l=u*e):(s.y+=Math.abs(u-l/e),u=l/e);const d=p(s,i,t.rotate);i=_(d,a),s=p(d,i,-t.rotate),c=p(a,i,-t.rotate),l=s.x-c.x,u=c.y-s.y}l>0&&u>0&&(t.width=Math.round(l),t.height=Math.round(u),t.left=Math.round(c.x),t.top=Math.round(s.y))}function Yt(t,n,e,o,r){const{symmetricPoint:a}=r;let i=_(n,a),s=p(a,i,-t.rotate),c=p(n,i,-t.rotate),l=c.x-s.x,u=c.y-s.y;if(o){l/u>e?(c.x-=Math.abs(l-u*e),l=u*e):(c.y-=Math.abs(u-l/e),u=l/e);const d=p(c,i,t.rotate);i=_(d,a),s=p(a,i,-t.rotate),c=p(d,i,-t.rotate),l=c.x-s.x,u=c.y-s.y}l>0&&u>0&&(t.width=Math.round(l),t.height=Math.round(u),t.left=Math.round(s.x),t.top=Math.round(s.y))}function Bt(t,n,e,o,r){const{symmetricPoint:a}=r;let i=_(n,a),s=p(a,i,-t.rotate),c=p(n,i,-t.rotate),l=s.x-c.x,u=c.y-s.y;if(o){l/u>e?(c.x+=Math.abs(l-u*e),l=u*e):(c.y-=Math.abs(u-l/e),u=l/e);const d=p(c,i,t.rotate);i=_(d,a),s=p(a,i,-t.rotate),c=p(d,i,-t.rotate),l=s.x-c.x,u=c.y-s.y}l>0&&u>0&&(t.width=Math.round(l),t.height=Math.round(u),t.left=Math.round(c.x),t.top=Math.round(s.y))}function Kt(t,n,e,o,r){const{symmetricPoint:a,curPoint:i}=r,s=p(n,i,-t.rotate),c=p({x:i.x,y:s.y},i,t.rotate),l=Math.sqrt((c.x-a.x)**2+(c.y-a.y)**2),u={x:c.x-(c.x-a.x)/2,y:c.y+(a.y-c.y)/2};let d=t.width;o&&(d=l*e),t.width=d,t.height=Math.round(l),t.top=Math.round(u.y-l/2),t.left=Math.round(u.x-t.width/2)}function Vt(t,n,e,o,r){const{symmetricPoint:a,curPoint:i}=r,s=p(n,i,-t.rotate),c=p({x:s.x,y:i.y},i,t.rotate),l=Math.sqrt((c.x-a.x)**2+(c.y-a.y)**2),u={x:c.x-(c.x-a.x)/2,y:c.y+(a.y-c.y)/2};let d=t.height;o&&(d=l/e),t.height=d,t.width=Math.round(l),t.top=Math.round(u.y-t.height/2),t.left=Math.round(u.x-l/2)}function Gt(t,n,e,o,r){const{symmetricPoint:a,curPoint:i}=r,s=p(n,i,-t.rotate),c=p({x:i.x,y:s.y},i,t.rotate),l=Math.sqrt((c.x-a.x)**2+(c.y-a.y)**2),u={x:c.x-(c.x-a.x)/2,y:c.y+(a.y-c.y)/2};let d=t.width;o&&(d=l*e),t.width=d,t.height=Math.round(l),t.top=Math.round(u.y-l/2),t.left=Math.round(u.x-t.width/2)}function Wt(t,n,e,o,r){const{symmetricPoint:a,curPoint:i}=r,s=p(n,i,-t.rotate),c=p({x:s.x,y:i.y},i,t.rotate),l=Math.sqrt((c.x-a.x)**2+(c.y-a.y)**2),u={x:c.x-(c.x-a.x)/2,y:c.y+(a.y-c.y)/2};let d=t.height;o&&(d=l/e),t.height=d,t.width=Math.round(l),t.top=Math.round(u.y-t.height/2),t.left=Math.round(u.x-l/2)}const Ht={lt:Ft,t:Kt,rt:Xt,r:Vt,rb:Yt,b:Gt,lb:Bt,l:Wt},qt=(t,n,e,o,r,a)=>{Ht[t](n,e,o,r,a)};var Ut=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{on:{click:t.handleClick}},[e(t.config.component,{ref:"component",tag:"component",staticClass:"component",style:t.getStyle(t.config.style),attrs:{"prop-value":t.config.propValue,element:t.config}})],1)},Jt=[];const Qt={mixins:[st],props:{config:{type:Object,require:!0,default:()=>{}}},components:{},data(){return{}},created(){},mounted(){A(this.$refs.component.$el,this.config.animations)},methods:{getStyle:M,handleClick(){const t=this.config.events;Object.keys(t).forEach(n=>{this[n](t[n])})}}},N={};var Zt=v(Qt,Ut,Jt,!1,te,"4135f03a",null,null);function te(t){for(let n in N)this[n]=N[n]}var ee=function(){return Zt.exports}(),ne=function(){var t=this,n=t.$createElement,e=t._self._c||n;return t.show?e("div",{staticClass:"bg"},[e("el-button",{staticClass:"close",on:{click:t.close}},[t._v("\u5173\u95ED")]),e("div",{staticClass:"canvas-container"},[e("div",{staticClass:"canvas",style:{width:t.changeStyleWithScale(t.canvasStyleData.width)+"px",height:t.changeStyleWithScale(t.canvasStyleData.height)+"px"}},t._l(t.componentData,function(o,r){return e("ComponentWrapper",{key:r,attrs:{config:o}})}),1)])],1):t._e()},oe=[];const ae={components:{ComponentWrapper:ee},model:{prop:"show",event:"change"},props:{show:{type:Boolean,default:!1}},data(){return{}},created(){},mounted(){},computed:f(["componentData","canvasStyleData"]),methods:{changeStyleWithScale:Q,getStyle:M,close(){this.$emit("change",!1)}}},O={};var ie=v(ae,ne,oe,!1,se,"3a9361c3",null,null);function se(t){for(let n in O)this[n]=O[n]}var re=function(){return ie.exports}(),ce=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("div",{staticClass:"toolbar"},[e("el-button",{on:{click:t.undo}},[t._v("\u64A4\u6D88 undo")]),e("el-button",{on:{click:t.redo}},[t._v("\u91CD\u505A redo")]),e("label",{staticClass:"insert",attrs:{for:"input"}},[t._v("\u63D2\u5165\u56FE\u7247")]),e("input",{attrs:{id:"input",type:"file",hidden:""},on:{change:t.handleFileChange}}),e("el-button",{staticStyle:{"margin-left":"10px"},on:{click:t.preview}},[t._v("\u9884\u89C8")]),e("el-button",{on:{click:t.save}},[t._v("\u4FDD\u5B58")]),e("el-button",{on:{click:t.clearCanvas}},[t._v("\u6E05\u7A7A\u753B\u5E03")]),e("el-button",{attrs:{disabled:!t.areaData.components.length},on:{click:t.compose}},[t._v("\u7EC4\u5408")]),e("el-button",{attrs:{disabled:!t.curComponent||t.curComponent.isLock||t.curComponent.component!="Group"},on:{click:t.decompose}},[t._v(" \u62C6\u5206 ")]),e("el-button",{attrs:{disabled:!t.curComponent||t.curComponent.isLock},on:{click:t.lock}},[t._v("\u9501\u5B9A")]),e("el-button",{attrs:{disabled:!t.curComponent||!t.curComponent.isLock},on:{click:t.unlock}},[t._v("\u89E3\u9501")]),e("div",{staticClass:"canvas-config"},[e("span",[t._v("\u753B\u5E03\u5927\u5C0F")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.canvasStyleData.width,expression:"canvasStyleData.width"}],domProps:{value:t.canvasStyleData.width},on:{input:function(o){o.target.composing||t.$set(t.canvasStyleData,"width",o.target.value)}}}),e("span",[t._v("*")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.canvasStyleData.height,expression:"canvasStyleData.height"}],domProps:{value:t.canvasStyleData.height},on:{input:function(o){o.target.composing||t.$set(t.canvasStyleData,"height",o.target.value)}}})]),e("div",{staticClass:"canvas-config"},[e("span",[t._v("\u753B\u5E03\u6BD4\u4F8B")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.scale,expression:"scale"}],domProps:{value:t.scale},on:{input:[function(o){o.target.composing||(t.scale=o.target.value)},t.handleScaleChange]}}),t._v(" % ")])],1),e("Preview",{on:{change:t.handlePreviewChange},model:{value:t.isShowPreview,callback:function(o){t.isShowPreview=o},expression:"isShowPreview"}})],1)},le=[];const ue={components:{Preview:re},data(){return{isShowPreview:!1,needToChange:["top","left","width","height","fontSize"],scale:"100%",timer:null}},computed:f(["componentData","canvasStyleData","areaData","curComponent","curComponentIndex"]),created(){h.$on("preview",this.preview),h.$on("save",this.save),h.$on("clearCanvas",this.clearCanvas),this.scale=this.canvasStyleData.scale},methods:{format(t){return rt(t,C(parseFloat(this.scale),100))},getOriginStyle(t){return C(t,C(parseFloat(this.canvasStyleData.scale),100))},handleScaleChange(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.scale=~~this.scale||1;const t=Z(this.componentData);t.forEach(n=>{Object.keys(n.style).forEach(e=>{this.needToChange.includes(e)&&(n.style[e]=this.format(this.getOriginStyle(n.style[e])))})}),this.$store.commit("setComponentData",t),this.$store.commit("setCurComponent",{component:t[this.curComponentIndex],index:this.curComponentIndex}),this.$store.commit("setCanvasStyle",{...this.canvasStyleData,scale:this.scale})},1e3)},lock(){this.$store.commit("lock")},unlock(){this.$store.commit("unlock")},compose(){this.$store.commit("compose"),this.$store.commit("recordSnapshot")},decompose(){this.$store.commit("decompose"),this.$store.commit("recordSnapshot")},undo(){this.$store.commit("undo")},redo(){this.$store.commit("redo")},handleFileChange(t){const n=t.target.files[0];if(!n.type.includes("image")){ct("\u53EA\u80FD\u63D2\u5165\u56FE\u7247");return}const e=new FileReader;e.onload=o=>{const r=o.target.result,a=new Image;a.onload=()=>{this.$store.commit("addComponent",{component:{...lt,id:L(),component:"Picture",label:"\u56FE\u7247",icon:"",propValue:{url:r,flip:{horizontal:!1,vertical:!1}},style:{...ut,top:0,left:0,width:a.width,height:a.height}}}),this.$store.commit("recordSnapshot"),k("#input").setAttribute("type","text"),k("#input").setAttribute("type","file")},a.src=r},e.readAsDataURL(n)},preview(){this.isShowPreview=!0,this.$store.commit("setEditMode","preview")},save(){localStorage.setItem("canvasData",JSON.stringify(this.componentData)),localStorage.setItem("canvasStyle",JSON.stringify(this.canvasStyleData)),this.$message.success("\u4FDD\u5B58\u6210\u529F")},clearCanvas(){this.$store.commit("setCurComponent",{component:null,index:null}),this.$store.commit("setComponentData",[]),this.$store.commit("recordSnapshot")},handlePreviewChange(){this.$store.commit("setEditMode","edit")}}},j={};var de=v(ue,ce,le,!1,pe,"2994cca9",null,null);function pe(t){for(let n in j)this[n]=j[n]}var me=function(){return de.exports}(),he=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"component-list",on:{dragstart:t.handleDragStart}},t._l(t.componentList,function(o,r){return e("div",{key:r,staticClass:"list",attrs:{draggable:"","data-index":r}},[e("span",{staticClass:"iconfont",class:"icon-"+o.icon}),e("span",[t._v(t._s(o.label))])])}),0)},ve=[];const fe={data(){return{componentList:tt}},methods:{handleDragStart(t){t.dataTransfer.setData("index",t.target.dataset.index)}}},z={};var _e=v(fe,he,ve,!1,ge,"4757d6e4",null,null);function ge(t){for(let n in z)this[n]=z[n]}var ot=function(){return _e.exports}(),xe=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("svg",{staticClass:"grid",attrs:{width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg"}},[e("defs",[e("pattern",{attrs:{id:"smallGrid",width:"7.236328125",height:"7.236328125",patternUnits:"userSpaceOnUse"}},[e("path",{attrs:{d:"M 7.236328125 0 L 0 0 0 7.236328125",fill:"none",stroke:"rgba(207, 207, 207, 0.3)","stroke-width":"1"}})]),e("pattern",{attrs:{id:"grid",width:"36.181640625",height:"36.181640625",patternUnits:"userSpaceOnUse"}},[e("rect",{attrs:{width:"36.181640625",height:"36.181640625",fill:"url(#smallGrid)"}}),e("path",{attrs:{d:"M 36.181640625 0 L 0 0 0 36.181640625",fill:"none",stroke:"rgba(186, 186, 186, 0.5)","stroke-width":"1"}})])]),e("rect",{attrs:{width:"100%",height:"100%",fill:"url(#grid)"}})])},ye=[];const be={},F={};var we=v(be,xe,ye,!1,Ce,"5a5f3a06",null,null);function Ce(t){for(let n in F)this[n]=F[n]}var $e=function(){return we.exports}(),Se=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.menuShow,expression:"menuShow"}],staticClass:"contextmenu",style:{top:t.menuTop+"px",left:t.menuLeft+"px"}},[e("ul",{on:{mouseup:t.handleMouseUp}},[t.curComponent?[t.curComponent.isLock?e("li",{on:{click:t.unlock}},[t._v("\u89E3\u9501")]):[e("li",{on:{click:t.copy}},[t._v("\u590D\u5236")]),e("li",{on:{click:t.paste}},[t._v("\u7C98\u8D34")]),e("li",{on:{click:t.cut}},[t._v("\u526A\u5207")]),e("li",{on:{click:t.deleteComponent}},[t._v("\u5220\u9664")]),e("li",{on:{click:t.lock}},[t._v("\u9501\u5B9A")]),e("li",{on:{click:t.topComponent}},[t._v("\u7F6E\u9876")]),e("li",{on:{click:t.bottomComponent}},[t._v("\u7F6E\u5E95")]),e("li",{on:{click:t.upComponent}},[t._v("\u4E0A\u79FB")]),e("li",{on:{click:t.downComponent}},[t._v("\u4E0B\u79FB")])]]:e("li",{on:{click:t.paste}},[t._v("\u7C98\u8D34")])],2)])},ke=[];const Me={data(){return{copyData:null}},computed:f(["menuTop","menuLeft","menuShow","curComponent"]),methods:{lock(){this.$store.commit("lock")},unlock(){this.$store.commit("unlock")},handleMouseUp(){this.$store.commit("setClickComponentStatus",!0)},cut(){this.$store.commit("cut")},copy(){this.$store.commit("copy")},paste(){this.$store.commit("paste",!0),this.$store.commit("recordSnapshot")},deleteComponent(){this.$store.commit("deleteComponent"),this.$store.commit("recordSnapshot")},upComponent(){this.$store.commit("upComponent"),this.$store.commit("recordSnapshot")},downComponent(){this.$store.commit("downComponent"),this.$store.commit("recordSnapshot")},topComponent(){this.$store.commit("topComponent"),this.$store.commit("recordSnapshot")},bottomComponent(){this.$store.commit("bottomComponent"),this.$store.commit("recordSnapshot")}}},X={};var Le=v(Me,Se,ke,!1,Ae,"6a2116bc",null,null);function Ae(t){for(let n in X)this[n]=X[n]}var De=function(){return Le.exports}(),Pe=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"shape",class:{active:t.active},on:{click:t.selectCurComponent,mousedown:t.handleMouseDownOnShape}},[e("span",{directives:[{name:"show",rawName:"v-show",value:t.isActive(),expression:"isActive()"}],staticClass:"iconfont icon-xiangyouxuanzhuan",on:{mousedown:t.handleRotate}}),e("span",{directives:[{name:"show",rawName:"v-show",value:t.element.isLock,expression:"element.isLock"}],staticClass:"iconfont icon-suo"}),t._l(t.isActive()?t.pointList:[],function(o){return e("div",{key:o,staticClass:"shape-point",style:t.getPointStyle(o),on:{mousedown:function(r){return t.handleMouseDownOnPoint(o,r)}}})}),t._t("default")],2)},Ee=[];const Re={props:{active:{type:Boolean,default:!1},element:{require:!0,type:Object,default:()=>{}},defaultStyle:{require:!0,type:Object,default:()=>{}},index:{require:!0,type:[Number,String],default:0}},data(){return{pointList:["lt","t","rt","r","rb","b","lb","l"],initialAngle:{lt:0,t:45,rt:90,r:135,rb:180,b:225,lb:270,l:315},angleToCursor:[{start:338,end:23,cursor:"nw"},{start:23,end:68,cursor:"n"},{start:68,end:113,cursor:"ne"},{start:113,end:158,cursor:"e"},{start:158,end:203,cursor:"se"},{start:203,end:248,cursor:"s"},{start:248,end:293,cursor:"sw"},{start:293,end:338,cursor:"w"}],cursors:{}}},computed:f(["curComponent","editor"]),mounted(){this.curComponent&&(this.cursors=this.getCursor()),h.$on("runAnimation",()=>{this.element==this.curComponent&&(console.log("this.$el",this.$el),A(this.$el,this.curComponent.animations))}),h.$on("stopAnimation",()=>{this.$el.classList.remove("animated","infinite")})},methods:{isActive(){return this.active&&!this.element.isLock},getPointStyle(t){const{width:n,height:e}=this.defaultStyle,o=/t/.test(t),r=/b/.test(t),a=/l/.test(t),i=/r/.test(t);let s=0,c=0;return t.length===2?(s=a?0:n,c=o?0:e):((o||r)&&(s=n/2,c=o?0:e),(a||i)&&(s=a?0:n,c=Math.floor(e/2))),{marginLeft:"-4px",marginTop:"-4px",left:`${s}px`,top:`${c}px`,cursor:this.cursors[t]}},getCursor(){const{angleToCursor:t,initialAngle:n,pointList:e,curComponent:o}=this,r=$(o.style.rotate),a={};let i=-1;return e.forEach(s=>{const c=$(n[s]+r),l=t.length;for(;;){i=(i+1)%l;const u=t[i];if(c<23||c>=338){a[s]="nw-resize";return}if(u.start<=c&&c<u.end){a[s]=u.cursor+"-resize";return}}}),a},handleRotate(t){this.$store.commit("setClickComponentStatus",!0),t.preventDefault(),t.stopPropagation();const n={...this.defaultStyle},e=t.clientY,o=t.clientX,r=n.rotate,a=this.$el.getBoundingClientRect(),i=a.left+a.width/2,s=a.top+a.height/2,c=Math.atan2(e-s,o-i)/(Math.PI/180);let l=!1;const u=g=>{l=!0;const x=g.clientX,y=g.clientY,w=Math.atan2(y-s,x-i)/(Math.PI/180);n.rotate=r+w-c,this.$store.commit("setShapeStyle",n)},d=()=>{l&&this.$store.commit("recordSnapshot"),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",d),this.cursors=this.getCursor()};document.addEventListener("mousemove",u),document.addEventListener("mouseup",d)},handleMouseDownOnShape(t){if(this.$store.commit("setInEditorStatus",!0),this.$store.commit("setClickComponentStatus",!0),this.element.component!="v-text"&&this.element.component!="rect-shape"&&t.preventDefault(),t.stopPropagation(),this.$store.commit("setCurComponent",{component:this.element,index:this.index}),this.element.isLock)return;this.cursors=this.getCursor();const n={...this.defaultStyle},e=t.clientY,o=t.clientX,r=Number(n.top),a=Number(n.left);let i=!1;const s=l=>{i=!0;const u=l.clientX,d=l.clientY;n.top=d-e+r,n.left=u-o+a,this.$store.commit("setShapeStyle",n),this.$nextTick(()=>{h.$emit("move",d-e>0,u-o>0)})},c=()=>{i&&this.$store.commit("recordSnapshot"),h.$emit("unmove"),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",c)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",c)},handleMouseDownOnPoint(t,n){n.stopPropagation(),n.preventDefault(),this.$store.commit("setInEditorStatus",!0),this.$store.commit("setClickComponentStatus",!0);const e={...this.defaultStyle},o=e.width/e.height,r={x:e.left+e.width/2,y:e.top+e.height/2},a=this.editor.getBoundingClientRect(),i=n.target.getBoundingClientRect(),s={x:Math.round(i.left-a.left+n.target.offsetWidth/2),y:Math.round(i.top-a.top+n.target.offsetHeight/2)},c={x:r.x-(s.x-r.x),y:r.y-(s.y-r.y)};let l=!1,u=!0;const d=this.isNeedLockProportion(),g=y=>{if(u){u=!1;return}l=!0;const w={x:y.clientX-a.left,y:y.clientY-a.top};qt(t,e,w,o,d,{center:r,curPoint:s,symmetricPoint:c}),this.$store.commit("setShapeStyle",e)},x=()=>{document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",x),l&&this.$store.commit("recordSnapshot")};document.addEventListener("mousemove",g),document.addEventListener("mouseup",x)},selectCurComponent(t){t.stopPropagation(),t.preventDefault(),this.$store.commit("hideContextMenu")},isNeedLockProportion(){if(this.element.componnet!="Group")return!1;const t=[0,90,180,360];for(const n of this.element.propValue)if(!t.includes($(parseInt(n.style.rotate))))return!0;return!1}}},Y={};var Ie=v(Re,Pe,Ee,!1,Te,"47a44cea",null,null);function Te(t){for(let n in Y)this[n]=Y[n]}var Ne=function(){return Ie.exports}(),Oe=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"mark-line"},t._l(t.lines,function(o){return e("div",{directives:[{name:"show",rawName:"v-show",value:t.lineStatus[o]||!1,expression:"lineStatus[line] || false"}],key:o,ref:o,refInFor:!0,staticClass:"line",class:o.includes("x")?"xline":"yline"})}),0)},je=[];const ze={data(){return{lines:["xt","xc","xb","yl","yc","yr"],diff:3,lineStatus:{xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}}},computed:f(["componentData","curComponent"]),mounted(){h.$on("move",(t,n)=>{this.showLine(t,n)}),h.$on("unmove",()=>{this.hideLine()})},methods:{hideLine(){Object.keys(this.lineStatus).forEach(t=>{this.lineStatus[t]=!1})},showLine(t,n){this.$refs;const e=this.componentData,o=b(this.curComponent.style);o.width/2,o.height/2,this.hideLine(),e.forEach(r=>{if(r==this.curComponent)return;const a=b(r.style);a.width/2,a.height/2})},isNearly(t,n){return Math.abs(t-n)<=this.diff}}},B={};var Fe=v(ze,Oe,je,!1,Xe,null,null,null);function Xe(t){for(let n in B)this[n]=B[n]}var Ye=function(){return Fe.exports}(),Be=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"area",style:{left:t.start.x+"px",top:t.start.y+"px",width:t.width+"px",height:t.height+"px"}})},Ke=[];const Ve={props:{start:{type:Object,default:()=>{}},width:{type:Number,default:0},height:{type:Number,default:0}}},K={};var Ge=v(Ve,Be,Ke,!1,We,"38da664e",null,null);function We(t){for(let n in K)this[n]=K[n]}var He=function(){return Ge.exports}(),qe=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"editor",class:{edit:t.isEdit},style:{width:t.changeStyleWithScale(t.canvasStyleData.width)+"px",height:t.changeStyleWithScale(t.canvasStyleData.height)+"px"},attrs:{id:"editor"},on:{contextmenu:t.handleContextMenu,mousedown:t.handleMouseDown}},[e("Grid"),t._l(t.componentData,function(o,r){return e("Shape",{key:o.id,class:{lock:o.isLock},style:t.getShapeStyle(o.style),attrs:{"default-style":o.style,active:o.id==(t.curComponent||{}).id,element:o,index:r}},[o.component!="v-text"?e(o.component,{tag:"component",staticClass:"component",style:t.getComponentStyle(o.style),attrs:{id:"component"+o.id,"prop-value":o.propValue,element:o}}):e(o.component,{tag:"component",staticClass:"component",style:t.getComponentStyle(o.style),attrs:{id:"component"+o.id,"prop-value":o.propValue,element:o},on:{input:t.handleInput}})],1)}),e("ContextMenu"),e("MarkLine"),e("Area",{directives:[{name:"show",rawName:"v-show",value:t.isShowArea,expression:"isShowArea"}],attrs:{start:t.start,width:t.width,height:t.height}})],2)},Ue=[];const Je=(t,n)=>{console.log("element, text",t,n);let{lineHeight:e,fontSize:o,height:r}=t.style;e===""&&(e=1.5);const a=(n.split("<br>").length-1)*e*o;return r>a?r:a},Qe={components:{Grid:$e,ContextMenu:De,MarkLine:Ye,Shape:Ne,ComponentList:ot,Area:He},props:{isEdit:{type:Boolean,default:!0}},data(){return{editorX:0,editorY:0,start:{x:0,y:0},width:0,height:0,isShowArea:!1}},computed:f(["componentData","curComponent","canvasStyleData","editor"]),mounted(){this.$store.commit("getEditor"),h.$on("hideArea",()=>{this.hideArea()})},methods:{changeStyleWithScale:Q,handleInput(t,n){this.$store.commit("setShapeStyle",{height:Je(t,n)})},handleContextMenu(t){t.stopPropagation(),t.preventDefault();let n=t.target,e=t.offsetY,o=t.offsetX;for(;n instanceof SVGElement;)n=n.parentNode;for(;!n.className.includes("editor");)o+=n.offsetLeft,e+=n.offsetTop,n=n.parentNode;this.$store.commit("showContextMenu",{top:e,left:o})},handleMouseDown(t){(!this.curComponent||this.curComponent.component!="v-text"&&this.curComponent.component!="rect-shape")&&t.preventDefault(),this.hideArea();const n=this.editor.getBoundingClientRect();this.editorX=n.x,this.editorY=n.y;const e=t.clientX,o=t.clientY;this.start.x=e-this.editorX,this.start.y=o-this.editorY,this.isShowArea=!0;const r=i=>{this.width=Math.abs(i.clientX-e),this.height=Math.abs(i.clientY-o),i.clientX<e&&(this.start.x=i.clientX-this.editorX),i.clientY<o&&(this.start.y=i.clientY-this.editorY)},a=i=>{if(document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a),i.clientX==e&&i.clientY==o){this.hideArea();return}this.createGroup()};document.addEventListener("mousemove",r),document.addEventListener("mouseup",a)},createGroup(){const t=this.getSelectArea();if(t.length<=1){this.hideArea();return}let n=1/0,e=1/0,o=-1/0,r=-1/0;t.forEach(a=>{let i={};a.component==="Group"?a.propValue.forEach(s=>{const c=k(`#component${s.id}`).getBoundingClientRect();i.left=c.left-this.editorX,i.top=c.top-this.editorY,i.right=c.right-this.editorX,i.bottom=c.bottom-this.editorY,i.left<e&&(e=i.left),i.top<n&&(n=i.top),i.right>o&&(o=i.right),i.bottom>r&&(r=i.bottom)}):i=b(a.style),i.left<e&&(e=i.left),i.top<n&&(n=i.top),i.right>o&&(o=i.right),i.bottom>r&&(r=i.bottom)}),this.start.x=e,this.start.y=n,this.width=o-e,this.height=r-n,this.$store.commit("setAreaData",{style:{left:e,top:n,width:this.width,height:this.height},components:t})},getSelectArea(){const t=[],{x:n,y:e}=this.start;return this.componentData.forEach(o=>{if(o.isLock)return;const{left:r,top:a,width:i,height:s}=b(o.style);n<=r&&e<=a&&r+i<=n+this.width&&a+s<=e+this.height&&t.push(o)}),t},hideArea(){this.isShowArea=!1,this.width=0,this.height=0,this.$store.commit("setAreaData",{style:{left:0,top:0,width:0,height:0},components:[]})},getShapeStyle(t){const n={};return["width","height","top","left","rotate"].forEach(e=>{e!="rotate"?n[e]=t[e]+"px":n.transform="rotate("+t[e]+"deg)"}),n},getComponentStyle(t){return M(t,["top","left","width","height","rotate"])}}},V={};var Ze=v(Qe,qe,Ue,!1,tn,"6e5fac24",null,null);function tn(t){for(let n in V)this[n]=V[n]}var en=function(){return Ze.exports}(),nn=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"attr-list"},[e("el-form",[t._l(t.styleKeys,function(o,r){var a=o.key,i=o.label;return e("el-form-item",{key:r,attrs:{label:i}},[a=="borderColor"?e("el-color-picker",{model:{value:t.curComponent.style[a],callback:function(s){t.$set(t.curComponent.style,a,s)},expression:"curComponent.style[key]"}}):a=="color"?e("el-color-picker",{model:{value:t.curComponent.style[a],callback:function(s){t.$set(t.curComponent.style,a,s)},expression:"curComponent.style[key]"}}):a=="backgroundColor"?e("el-color-picker",{model:{value:t.curComponent.style[a],callback:function(s){t.$set(t.curComponent.style,a,s)},expression:"curComponent.style[key]"}}):t.selectKey.includes(a)?e("el-select",{model:{value:t.curComponent.style[a],callback:function(s){t.$set(t.curComponent.style,a,s)},expression:"curComponent.style[key]"}},[a=="textAlign"?t._l(t.textAlignOptions,function(s){return e("el-option",{key:s.value,attrs:{label:s.label,value:s.value}})}):a=="borderStyle"?t._l(t.borderStyleOptions,function(s){return e("el-option",{key:s.value,attrs:{label:s.label,value:s.value}})}):t._l(t.verticalAlignOptions,function(s){return e("el-option",{key:s.value,attrs:{label:s.label,value:s.value}})})],2):e("el-input",{attrs:{type:"number"},model:{value:t.curComponent.style[a],callback:function(s){t.$set(t.curComponent.style,a,t._n(s))},expression:"curComponent.style[key]"}})],1)}),t.curComponent&&!t.excludes.includes(t.curComponent.component)?e("el-form-item",{attrs:{label:"\u5185\u5BB9"}},[e("el-input",{attrs:{type:"textarea"},model:{value:t.curComponent.propValue,callback:function(o){t.$set(t.curComponent,"propValue",o)},expression:"curComponent.propValue"}})],1):t._e(),t.curComponent&&t.curComponent.component==="Picture"?e("el-form-item",{attrs:{label:"\u955C\u50CF\u7FFB\u8F6C"}},[e("div",{staticStyle:{clear:"both"}},[e("el-checkbox",{attrs:{label:"horizontal"},model:{value:t.curComponent.propValue.flip.horizontal,callback:function(o){t.$set(t.curComponent.propValue.flip,"horizontal",o)},expression:"curComponent.propValue.flip.horizontal"}},[t._v("\u6C34\u5E73\u7FFB\u8F6C")]),e("el-checkbox",{attrs:{label:"vertical"},model:{value:t.curComponent.propValue.flip.vertical,callback:function(o){t.$set(t.curComponent.propValue.flip,"vertical",o)},expression:"curComponent.propValue.flip.vertical"}},[t._v("\u5782\u76F4\u7FFB\u8F6C")])],1)]):t._e()],2)],1)},on=[];const an={components:{},data(){return{excludes:["Picture","Group"],textAlignOptions:[{label:"\u5DE6\u5BF9\u9F50",value:"left"},{label:"\u5C45\u4E2D",value:"center"},{label:"\u53F3\u5BF9\u9F50",value:"right"}],borderStyleOptions:[{label:"\u5B9E\u7EBF",value:"solid"},{label:"\u865A\u7EBF",value:"dashed"}],verticalAlignOptions:[{label:"\u4E0A\u5BF9\u9F50",value:"top"},{label:"\u5C45\u4E2D\u5BF9\u9F50",value:"middle"},{label:"\u4E0B\u5BF9\u9F50",value:"bottom"}],selectKey:["textAlign","borderStyle","verticalAlign"],styleData:dt}},created(){},mounted(){},methods:{},computed:{styleKeys(){if(this.curComponent){const t=Object.keys(this.curComponent.style);return this.styleData.filter(n=>t.includes(n.key))}return[]},curComponent(){return this.$store.state.curComponent}}},G={};var sn=v(an,nn,on,!1,rn,"31868d65",null,null);function rn(t){for(let n in G)this[n]=G[n]}var cn=function(){return sn.exports}(),ln=function(){var t=this,n=t.$createElement,e=t._self._c||n;return t.show?e("div",{staticClass:"modal-bg",on:{click:t.hide}},[e("div",{staticClass:"fadeInLeft animated modal",on:{click:t.stopPropagation}},[t._t("default")],2)]):t._e()},un=[];const dn={model:{prop:"show",event:"change"},props:{show:{type:Boolean,default:!1}},components:{},data(){return{}},created(){},mounted(){},methods:{hide(){this.$emit("change")},stopPropagation(t){t.stopPropagation()}}},W={};var pn=v(dn,ln,un,!1,mn,"e1764b10",null,null);function mn(t){for(let n in W)this[n]=W[n]}var at=function(){return pn.exports}(),hn=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("el-dialog",{attrs:{title:`${t.config.label} \u52A8\u753B\u914D\u7F6E`,visible:t.centerDialogVisible,width:"30%",center:""},on:{close:t.handleCloseModal}},[e("div",{staticClass:"time"},[t._v(" \u52A8\u753B\u65F6\u957F\uFF1A"),e("el-input-number",{attrs:{"controls-position":"right",min:.1,precision:2,step:.01},model:{value:t.config.animationTime,callback:function(o){t.$set(t.config,"animationTime",o)},expression:"config.animationTime"}})],1),e("div",{staticClass:"loop"},[t._v(" \u662F\u5426\u5FAA\u73AF\uFF1A"),e("el-switch",{attrs:{"active-text":"\u662F","inactive-text":"\u5426",disabled:t.isDisabled},model:{value:t.config.isLoop,callback:function(o){t.$set(t.config,"isLoop",o)},expression:"config.isLoop"}})],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.handleCloseModal}},[t._v("\u53D6 \u6D88")]),e("el-button",{attrs:{type:"primary"},on:{click:t.handleSaveSetting}},[t._v("\u786E \u5B9A")])],1)])},vn=[];const fn={name:"AnimationSettingModal",props:{curIndex:{type:Number,default:0}},components:{},data(){return{centerDialogVisible:!0,config:{}}},computed:{...f(["curComponent"]),isDisabled(){return this.curComponent.animations.length>1}},created(){const{label:t,animationTime:n,isLoop:e=!1,value:o}=this.curComponent.animations[this.curIndex]||{};this.config={animationTime:n,label:t,isLoop:e,value:o}},mounted(){},methods:{handleCloseModal(){this.$emit("close")},handleSaveSetting(){const{isLoop:t}=this.config;this.$store.commit("alterAnimation",{index:this.curIndex,data:{animationTime:this.config.animationTime,isLoop:t}}),h.$emit("stopAnimation"),this.handleCloseModal()}}},H={};var _n=v(fn,hn,vn,!1,gn,"78a8f4e4",null,null);function gn(t){for(let n in H)this[n]=H[n]}var xn=function(){return _n.exports}(),yn=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"animation-list"},[e("div",{staticClass:"div-animation"},[e("el-button",{on:{click:function(o){t.isShowAnimation=!0}}},[t._v("\u6DFB\u52A0\u52A8\u753B")]),e("el-button",{on:{click:t.previewAnimate}},[t._v("\u9884\u89C8\u52A8\u753B")]),e("div",t._l(t.curComponent.animations,function(o,r){return e("el-tag",{key:r,attrs:{closable:""},on:{close:function(a){return t.removeAnimation(r)}}},[t._v(" "+t._s(o.label)+" "),e("i",{staticClass:"cursor el-icon-setting",on:{click:function(a){return t.handleAnimationSetting(r)}}})])}),1)],1),e("Modal",{model:{value:t.isShowAnimation,callback:function(o){t.isShowAnimation=o},expression:"isShowAnimation"}},[e("el-tabs",{model:{value:t.animationActiveName,callback:function(o){t.animationActiveName=o},expression:"animationActiveName"}},t._l(t.animationClassData,function(o){return e("el-tab-pane",{key:o.label,attrs:{label:o.label,name:o.label}},[e("el-scrollbar",{staticClass:"animate-container"},t._l(o.children,function(r){return e("div",{key:r.value,ref:r.value,refInFor:!0,staticClass:"animate",on:{mouseenter:function(a){return t.runAnimation(r)},click:function(a){return t.addAnimation(r)}}},[e("div",[t._v(" "+t._s(r.label)+" ")])])}),0)],1)}),1)],1),t.isShowAnimationSetting?e("AnimationSettingModal",{attrs:{"cur-index":t.curIndex},on:{close:function(o){t.isShowAnimationSetting=!1}}}):t._e()],1)},bn=[];const wn={components:{Modal:at,AnimationSettingModal:xn},data(){return{isShowAnimation:!1,hoverPreviewAnimate:"",animationActiveName:"\u8FDB\u5165",animationClassData:pt,showAnimatePanel:!1,timer:null,isShowAnimationSetting:!1,curIndex:0}},computed:f(["curComponent"]),created(){},mounted(){},methods:{addAnimation(t){this.$store.commit("addAnimation",t),this.isShowAnimation=!1},previewAnimate(){h.$emit("runAnimation")},removeAnimation(t){this.$store.commit("removeAnimation",t),this.curComponent.animations.length||h.$emit("stopAnimation")},handleAnimationSetting(t){this.isShowAnimationSetting=!0,this.curIndex=t},async runAnimation(t){t.pending||(t.pending=!0,await A(this.$refs[t.value][0],[t]),setTimeout(()=>{t.pending=!1},100))}}},q={};var Cn=v(wn,yn,bn,!1,$n,null,null,null);function $n(t){for(let n in q)this[n]=q[n]}var Sn=function(){return Cn.exports}(),kn=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"event-list"},[e("div",{staticClass:"div-events"},[e("el-button",{on:{click:function(o){t.isShowEvent=!0}}},[t._v("\u6DFB\u52A0\u4E8B\u4EF6")]),e("div",t._l(Object.keys(t.curComponent.events),function(o){return e("el-tag",{key:o,attrs:{closable:""},on:{close:function(r){return t.removeEvent(o)}}},[t._v(" "+t._s(o)+" ")])}),1)],1),e("Modal",{model:{value:t.isShowEvent,callback:function(o){t.isShowEvent=o},expression:"isShowEvent"}},[e("el-tabs",{model:{value:t.eventActiveName,callback:function(o){t.eventActiveName=o},expression:"eventActiveName"}},t._l(t.eventList,function(o){return e("el-tab-pane",{key:o.key,staticStyle:{padding:"0 20px"},attrs:{label:o.label,name:o.key}},[o.key=="redirect"?e("el-input",{attrs:{type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u5B8C\u6574\u7684 URL"},nativeOn:{keydown:function(r){r.stopPropagation()}},model:{value:o.param,callback:function(r){t.$set(o,"param",r)},expression:"item.param"}}):t._e(),o.key=="alert"?e("el-input",{attrs:{type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u8981 alert \u7684\u5185\u5BB9"},nativeOn:{keydown:function(r){r.stopPropagation()}},model:{value:o.param,callback:function(r){t.$set(o,"param",r)},expression:"item.param"}}):t._e(),e("el-button",{staticStyle:{"margin-top":"20px"},on:{click:function(r){return t.addEvent(o.key,o.param)}}},[t._v("\u786E\u5B9A")])],1)}),1)],1)],1)},Mn=[];const Ln={components:{Modal:at},data(){return{isShowEvent:!1,eventURL:"",eventActiveName:"redirect",eventList:mt}},created(){},mounted(){},computed:f(["curComponent"]),methods:{addEvent(t,n){this.isShowEvent=!1,this.$store.commit("addEvent",{event:t,param:n})},removeEvent(t){this.$store.commit("removeEvent",t)}}},U={};var An=v(Ln,kn,Mn,!1,Dn,"60e8e256",null,null);function Dn(t){for(let n in U)this[n]=U[n]}var Pn=function(){return An.exports}(),En=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"home"},[e("Toolbar"),e("main",[e("section",{staticClass:"left"},[e("ComponentList")],1),e("section",{staticClass:"center"},[e("div",{staticClass:"content",on:{drop:t.handleDrop,dragover:t.handleDragOver,mousedown:t.handleMouseDown,mouseup:t.deselectCurComponent}},[e("Editor")],1)]),e("section",{staticClass:"right"},[e("el-tabs",{model:{value:t.activeName,callback:function(o){t.activeName=o},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:"\u5C5E\u6027",name:"attr"}},[t.curComponent?e("AttrList"):e("p",{staticClass:"placeholder"},[t._v("\u8BF7\u9009\u62E9\u7EC4\u4EF6")])],1),e("el-tab-pane",{attrs:{label:"\u52A8\u753B",name:"animation"}},[t.curComponent?e("AnimationList"):e("p",{staticClass:"placeholder"},[t._v("\u8BF7\u9009\u62E9\u7EC4\u4EF6")])],1),e("el-tab-pane",{attrs:{label:"\u4E8B\u4EF6",name:"events"}},[t.curComponent?e("EventList"):e("p",{staticClass:"placeholder"},[t._v("\u8BF7\u9009\u62E9\u7EC4\u4EF6")])],1)],1)],1)])],1)},Rn=[];const it=t=>(t.forEach(n=>{n.id=L(),n.component==="Group"&&it(n.propValue)}),t),In={components:{Toolbar:me,ComponentList:ot,Editor:en,AttrList:cn,AnimationList:Sn,EventList:Pn},data(){return{activeName:"attr",reSelectAnimateIndex:void 0}},computed:f(["componentData","curComponent","isClickComponent","canvasStyleData","editor"]),created(){this.restore(),zt()},methods:{restore(){const t=localStorage.getItem("canvasData"),n=localStorage.getItem("canvasStyle");t&&this.$store.commit("setComponentData",it(JSON.parse(t))),n&&this.$store.commit("setCanvasStyle",JSON.parse(n))},handleDrop(t){t.preventDefault(),t.stopPropagation();const n=t.dataTransfer.getData("index"),e=this.editor.getBoundingClientRect();if(n){const o=Z(tt[n]);o.style.top=t.clientY-e.y,o.style.left=t.clientX-e.x,o.id=L(),this.$store.commit("addComponent",{component:o}),this.$store.commit("recordSnapshot")}},handleDragOver(t){console.log("handleDragOver",t),t.preventDefault(),t.dataTransfer.dropEffect="copy"},handleMouseDown(t){t.stopPropagation(),this.$store.commit("setClickComponentStatus",!1),this.$store.commit("setInEditorStatus",!0)},deselectCurComponent(t){this.isClickComponent||this.$store.commit("setCurComponent",{component:null,index:null}),t.button!=2&&this.$store.commit("hideContextMenu")}}},J={};var Tn=v(In,En,Rn,!1,Nn,null,null,null);function Nn(t){for(let n in J)this[n]=J[n]}var jn=function(){return Tn.exports}();export{jn as default};
